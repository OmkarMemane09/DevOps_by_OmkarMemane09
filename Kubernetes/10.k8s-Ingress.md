# Ingress in Kubernetes 

##  What is Ingress?
Ingress is a **Kubernetes API object** that manages **external access** to applications running inside the cluster.  
It provides **HTTP/HTTPS routing** to internal Services.

Ingress = Intelligent router â†’ Maps incoming requests to backend services using rules like:
- URL paths (e.g., `/app1`)
- Hostnames (e.g., `app.example.com`)

---

##  Why Do We Need Ingress?
Without Ingress, every service that needs external access must use:
- **NodePort** (port exposed on every node)  
- **LoadBalancer** (AWS/Azure/GCP external LB for each service)

This becomes expensive and unmanageable.

**Ingress solves this by using one single Load Balancer** â†’ then routes traffic internally.

---

##  Components of Ingress
| Component | Description |
|----------|-------------|
| **Ingress Resource** | The YAML object containing routing rules. |
| **Ingress Controller** | Software that implements Ingress logic (e.g., NGINX). |
| **Service** | Backend target that receives traffic. |
| **Pods/Deployments** | Applications that run behind the services. |

Ingress works ONLY when an **Ingress Controller** is installed.

Most popular: **NGINX Ingress Controller**.

---

##  How Ingress Works (High-Level Flow)

Client â†’ DNS (LB hostname) â†’ Cloud Load Balancer â†’ Ingress Controller â†’ Service â†’ Pod

1. User hits LB DNS (created by controller).  
2. LB forwards traffic to Ingress Controller Pod.  
3. Controller checks rules in `Ingress` YAML.  
4. Routes to appropriate **Service**.  
5. Service forwards traffic to **Pods**.

---

##  Features of Ingress

###  HTTP/HTTPS Routing
Route based on:
- **Path** (e.g., `/app1 â†’ app1-svc`)
- **Host** (e.g., `app.example.com â†’ app1-svc`)

###  TLS/SSL Termination
You can attach certificates so HTTPS terminates at Ingress.

###  Load Balancing
Internal traffic is balanced across backend Pods.

###  URL Rewriting
Rewrite paths using annotations.

###  Centralized access point
One LB for all services â†’ cheaper & simpler.

---

##  Types of Ingress Routing

### ðŸ”¹ **1. Path-Based Routing**
Different URL paths â†’ different Services.

Example:
/app1 â†’ app1-svc
/app2 â†’ app2-svc

### ðŸ”¹ **2. Host-Based Routing**
Different domains â†’ different Services.

Example:
app1.example.com â†’ app1-svc
app2.example.com â†’ app2-svc

---

##  Common Annotations in NGINX Ingress

| Annotation | Purpose |
|------------|---------|
| `nginx.ingress.kubernetes.io/rewrite-target` | Rewrite incoming URL. |
| `nginx.ingress.kubernetes.io/ssl-redirect` | Force HTTPS. |
| `nginx.ingress.kubernetes.io/proxy-body-size` | Increase request body size. |

To view annotations applied:
kubectl describe ing <ingress-name>

---

##  Ingress Controller (Important!)
Ingress WILL NOT WORK without an Ingress Controller.

Most common:
- **NGINX Ingress Controller**
- AWS ALB Ingress Controller
- Traefik
- Istio Gateway

In EKS:  
We use **NGINX Ingress Controller** â†’ creates an AWS Load Balancer automatically.

Install:
```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```
---

## Ingress YAML Structure (Concept)

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
spec:
  ingressClassName: nginx
  rules:
  - host: example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: example-service
            port:
              number: 80
```
# Practical for Ingress
## Step 1. Setup the EKS Cluster With EC2 instance
   **For setup you can refer this notes**
      *Make eks cluster and also make node group in it*
 
 ```bash
https://github.com/OmkarMemane09/DevOps_by_OmkarMemane09/blob/main/Kubernetes/2.k8s-EKS-Setup-with-EC2.md
```
##  Install NGINX Ingress Controller
Apply the official manifest:

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```

**Verify installation:**

```sh
kubectl get pods -n ingress-nginx
```
```bash
kubectl get svc -n ingress-nginx
```
## Step 2. Make App 1 file(Deployment + Service) and apply it :
 ```bash
  nano app1-deploy.yaml
 ```
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app1
  template:
    metadata:
      labels:
        app: app1
    spec:
      containers:
      - name: app1
        image: hashicorp/http-echo
        args:
        - "-text=Hello from App1"
        ports:
        - containerPort: 5678
---
apiVersion: v1
kind: Service
metadata:
  name: app1-svc
spec:
  selector:
    app: app1
  ports:
  - port: 80
    targetPort: 5678
```
**Apply this file**

```bash
kubectl apply -f app1-deploy.yaml
```
## Step 3. Make App 2 file(Deployment + Service) and apply it :
 ```bash
  nano app2-deploy.yaml
 ```
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app2
spec:
  replicas: 1
  selector:
    matchLabels:
      app: app2
  template:
    metadata:
      labels:
        app: app2
    spec:
      containers:
      - name: app2
        image: hashicorp/http-echo
        args:
        - "-text=Hello from App2"
        ports:
        - containerPort: 5678
---
apiVersion: v1
kind: Service
metadata:
  name: app2-svc
spec:
  selector:
    app: app2
  ports:
  - port: 80
    targetPort: 5678
```
**Apply this file**

```bash
kubectl apply -f app2-deploy.yaml
```
## Step 4. Make Ingress file 
```bash
nano ingress.yaml
```
**File for Path Based Routing**
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: path-based-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
  - http:
      paths:
      - path: /app1
        pathType: Prefix
        backend:
          service:
            name: app1-svc
            port:
              number: 80
      - path: /app2
        pathType: Prefix
        backend:
          service:
            name: app2-svc
            port:
              number: 80
```
**Apply this file**

```bash
kubectl apply -f ingress.yaml
```
### If you are doing Host Based Routing then use below file and also make changes in app1 & app2 file 
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: host-based-ingress
spec:
  ingressClassName: nginx
  rules:
  - host: app1.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app1-svc
            port:
              number: 80
  - host: app2.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app2-svc
            port:
              number: 80
```
## Step 5. To verify this 

**Go to Load balancer**

**One Load balancer in created there**

**Copy the dns name and hit it to browser**

**also you can make changes in path by adding /app1 Or /app2**
```
